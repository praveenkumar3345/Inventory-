<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inventory Dashboard</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <style>
  * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
  body { background-color: #080710; color: #fff; overflow-x: hidden; min-height: 100vh; }

  .background { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 0; }
  .shape { position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.6; }
  .shape:nth-child(1){ background: linear-gradient(#1845ad, #23a2f6); width: 400px; height: 400px; top: -150px; left: -200px; }
  .shape:nth-child(2){ background: linear-gradient(to right, #ff512f, #f09819); width: 350px; height: 350px; bottom: -150px; right: -200px; }

  .topbar {
    display: flex; justify-content: space-between; align-items: center; padding: 15px 30px;
    background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: 10px;
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.05); margin: 20px; position: relative; z-index: 2;
  }

  .search-box input {
    padding: 10px; width: 250px; border-radius: 8px; border: none; outline: none;
    background: rgba(255, 255, 255, 0.2); color: #fff;
  }
  .search-box input::placeholder { color: #ddd; }

  .add-btn, .logout-btn, .locations-btn {
    background: rgba(255, 255, 255, 0.2); color: #fff; padding: 10px 15px; border-radius: 8px;
    border: none; cursor: pointer; transition: 0.3s;
  }
  .add-btn:hover, .logout-btn:hover, .locations-btn:hover {
    background: rgba(255, 255, 255, 0.4);
  }

  .sidebar {
    width: 200px; position: fixed; top: 100px; left: 20px;
    background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px);
    border-radius: 12px; padding: 20px;
    box-shadow: 0 0 20px rgba(255,255,255,0.05); z-index: 2;
  }
  .filter-btn, .analyze-btn {
    width: 100%; padding: 10px; margin-bottom: 10px; border: none; border-radius: 6px;
    background: rgba(255, 255, 255, 0.2); color: #fff; cursor: pointer; transition: 0.3s;
  }
  .filter-btn:hover, .analyze-btn:hover { background: rgba(255, 255, 255, 0.4); }

  .card-container {
    margin-left: 250px; margin-top: 100px;
    display: flex; flex-wrap: wrap; gap: 25px; padding: 20px;
    justify-content: flex-start; position: relative; z-index: 2;
  }
  .card {
    width: 220px; background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(15px);
    border-radius: 15px; box-shadow: 0 0 20px rgba(0,0,0,0.3);
    padding: 15px; text-align: center; transition: transform 0.3s;
  }
  .card:hover { transform: scale(1.05); }
  .card img { width: 180px; height: 130px; border-radius: 10px; object-fit: cover; }
  .card h4 { margin-top: 10px; font-size: 18px; color: #f2f2f2; }
  .card p { font-size: 14px; margin: 5px 0; color: #ddd; }

  .card-buttons {
    display: flex;
    gap: 8px;
    justify-content: center;
    margin-top: 15px;
    flex-wrap: nowrap;
  }

  .save-btn, .edit-btn, .delete-btn-small {
    background: linear-gradient(135deg, #00c6ff, #0072ff);
    color: #fff;
    border: none;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    font-size: 11px;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 60px;
    flex: 1;
    text-align: center;
  }

  .edit-btn {
    background: linear-gradient(135deg, #b026ff, #8e44ad);
  }

  .delete-btn-small {
    background: linear-gradient(135deg, #ff4757, #c44569);
  }

  .save-btn:hover, .edit-btn:hover, .delete-btn-small:hover { 
    filter: brightness(1.2); 
    transform: translateY(-2px);
  }

  /* Responsive design for buttons */
  @media (max-width: 768px) {
    .card-buttons {
      gap: 5px;
    }
    
    .save-btn, .edit-btn, .delete-btn-small {
      padding: 6px 12px;
      font-size: 10px;
      min-width: 50px;
    }
  }

  @media (max-width: 480px) {
    .card-buttons {
      flex-direction: column;
      gap: 5px;
    }
    
    .save-btn, .edit-btn, .delete-btn-small {
      flex: none;
      width: 100%;
    }
  }

  .save-btn:hover { 
    filter: brightness(1.2); 
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 198, 255, 0.4);
  }
  </style>
</head>
<body>

  <div class="background"><div class="shape"></div><div class="shape"></div></div>

  <!-- TOP BAR -->
  <div class="topbar">
    <div style="display:flex; align-items:center; gap:10px;">
      <div class="search-box">
        <input type="text" id="search" placeholder="Search product...">
      </div>
      <a href="/locations" class="locations-btn">üìç Locations</a>
    </div>
    <div style="display:flex; align-items:center; gap:8px;">
      <a href="/add" class="add-btn">+ Add Product</a>
      <a href="/logout" class="logout-btn">Logout</a>
    </div>
  </div>

  <!-- SIDEBAR -->
  <div class="sidebar">
    <h3>Filters</h3>
    <button class="filter-btn" data-category="">All</button>
    <button class="filter-btn" data-category="Laptop">Laptop</button>
    <button class="filter-btn" data-category="Mobile">Mobile</button>
    <button class="filter-btn" data-category="Smart Watch">Smart Watch</button>
    <a href="/analyze" class="analyze-btn">Analyze</a>
  </div>

  <!-- PRODUCT CARDS -->
  <div class="card-container" id="product-list">
    {% for product in products %}
    <div class="card">
      <img src="{{ url_for('static', filename='images/' + product.image) }}" alt="{{ product.name }}">
      <h4>{{ product.name }}</h4>
      <p>Category: {{ product.category }}</p>
      <p>Qty: {{ product.quantity }}</p>
      <div class="card-buttons">
        <a href="/product/{{ product.id }}" class="save-btn">üëÅÔ∏è View</a>
        <a href="/edit/{{ product.id }}" class="edit-btn">‚úèÔ∏è Edit</a>
        <button class="delete-btn-small" data-product-id="{{ product.id }}" data-product-name="{{ product.name }}">üóëÔ∏è Del</button>
      </div>
    </div>
    {% endfor %}
  </div>

  <!-- No modals needed anymore since we have dedicated locations page -->

<script>
$(document).ready(function() {
  // ===== Dummy Data (removed locations and movements data since we have dedicated page) =====

  // ====== Render Functions (removed since not needed) ======

  // ====== Search and Filter Functions ======
  $('#search').on('input', function() {
    const query = $(this).val().toLowerCase();
    $('.card').each(function() {
      const cardText = $(this).text().toLowerCase();
      if (cardText.includes(query)) {
        $(this).show();
      } else {
        $(this).hide();
      }
    });
  });

  $('.filter-btn').click(function() {
    const category = $(this).data('category');
    $('.filter-btn').removeClass('active');
    $(this).addClass('active');
    
    if (category === '') {
      $('.card').show();
    } else {
      $('.card').each(function() {
        const cardCategory = $(this).find('p:first').text();
        if (cardCategory.includes(category)) {
          $(this).show();
        } else {
          $(this).hide();
        }
      });
    }
  });

  // ====== Delete Product Event Delegation ======
  $(document).on('click', '.delete-btn-small', function() {
    const productId = $(this).data('product-id');
    const productName = $(this).data('product-name');
    deleteProductFromInventory(productId, productName, this);
  });

});

// ====== Delete Product Function ======
function deleteProductFromInventory(productId, productName, buttonElement) {
  if (confirm(`Are you sure you want to delete "${productName}"? This action cannot be undone.`)) {
    // Show loading state
    const deleteBtn = buttonElement;
    const originalText = deleteBtn.innerHTML;
    deleteBtn.innerHTML = '‚è≥';
    deleteBtn.disabled = true;
    
    // Make AJAX request to delete the product
    $.post('/delete/' + productId)
      .done(function(response) {
        if (response.success) {
          // Remove the card from the page
          $(deleteBtn).closest('.card').fadeOut(300, function() {
            $(this).remove();
          });
          
          // Show success message
          alert('‚úÖ Product deleted successfully!');
        } else {
          alert('‚ùå Failed to delete product: ' + response.message);
          // Reset button
          deleteBtn.innerHTML = originalText;
          deleteBtn.disabled = false;
        }
      })
      .fail(function() {
        alert('‚ùå Error occurred while deleting the product. Please try again.');
        // Reset button
        deleteBtn.innerHTML = originalText;
        deleteBtn.disabled = false;
      });
  }
}
</script>

</body>
</html>
